# 花札ゲーム仕様（ルール）

## 対象ゲーム
- 本仕様は2人対戦の花札「こいこい」を前提にする。
- 12局（1〜12月）を1セットとし、総得点で勝敗を決定する。

## 目的
- 自分の得点を相手より多く獲得する。
- 得点は役の成立とコイコイ宣言後の加点で構成される。

## 使用カード
- 12か月×4枚の計48枚。
- カードの分類
  - 光札（明かり）：松の鶴など5枚（あめ四光の雨札含む）
  - タネ札（動物札）：9枚
  - 短冊札：10枚（赤短3枚、青短3枚、その他4枚）
  - カス札：24枚（柳の雨札は特殊な光札）

## 用語
- 場札：配られて場に表向きになっている札。
- 手札：プレイヤーが持っている札。
- 山札：残りの伏せ札。
- 役札：役成立に使用する札のセット。
- コイコイ：役成立後に局を継続して追加得点を狙う宣言。

## ゲーム進行
### 準備
1. デッキをシャッフルする。
2. 各プレイヤーに8枚ずつ配る。
3. 場に8枚を表向きに並べる。
4. 残りは山札として中央に伏せる。
5. 初手番はランダム、以降は前局で得点したプレイヤーが先攻（同点なら交代）。

### 手番の流れ
1. プレイヤーは手札から1枚を場に出す。
2. 出した札と同じ月の札が場にあれば
   - 1枚一致：2枚まとめて獲得札へ移動。
   - 複数一致：獲得したい札を1枚選び、選んだ札と手札を獲得。残りは場へ。
   - 一致なし：出した札を場に残す。
3. 山札から1枚めくり、表向きで場に出す。
4. 同じ月が場にあれば上記と同様に獲得判定する。なければ場に残す。
5. 獲得札を役ごとに整理し、役成立をチェックする。

### 役成立後の選択
- 初めて役が成立した手番で「上がる」か「コイコイする」かを選ぶ。
- コイコイした場合、その局では再び役を成立させない限り上がれない。
- コイコイ中に相手が上がった場合、相手の得点は2倍になる。

### 局の終了条件
- プレイヤーのどちらかが上がりを宣言したとき。
- 両者の手札と山札が尽きたとき（流局）。
- 月札がすべて場から無くなるなどで進行不能になったとき（再配札）。

### 流局時の処理
- 役が成立していなければ得点は入らない。
- 「手札または場札が4枚同じ月」「場の札がすべて同じ月」などの特殊な再配札条件があれば、局をやり直す。

## 得点計算
- 基本は成立した役の得点合計。
- コイコイ中に上がれば倍付け（1回コイコイ:×2、2回連続コイコイ:×4）。
- 相手がコイコイ中に上がった場合も同様に倍付けされる。

### 役一覧（標準的なこいこい）
| 役名 | 条件 | 基本点 | 加点ルール |
| --- | --- | --- | --- |
| 五光 | 光札5枚 | 10 | - |
| 四光 | 光札4枚（雨札を含む） | 8 | 雨札なしなら三光扱い |
| 雨四光 | 雨札を含む光札4枚 | 7 | - |
| 三光 | 光札3枚（雨札含まず） | 5 | - |
| 花見で一杯 | 桜に幕 + 酒 | 5 | - |
| 月見で一杯 | 月 + 酒 | 5 | - |
| 猪鹿蝶 | 猪＋鹿＋蝶 | 5 | - |
| 赤短 | 赤短3枚 | 5 | 4枚目以降1点ずつ追加 |
| 青短 | 青短3枚 | 5 | 4枚目以降1点ずつ追加 |
| 短冊 | 短冊5枚 | 1 | 6枚目以降1点ずつ追加 |
| タネ | タネ5枚 | 1 | 6枚目以降1点ずつ追加 |
| カス | カス10枚 | 1 | 11枚目以降1点ずつ追加 |
| 花札くっつき | 同月を4枚揃える | 4 | 再配札条件と両立しない |

### 追加ルール案
- 早上がりボーナス：配札後2手以内で上がった場合 +1点。
- 完全勝利：相手が一度も役を作れず12局終了で+5点。

## 勝敗判定
- 12局終了時に合計得点が高いプレイヤーが勝ち。
- 合計点が同じ場合は引き分け。延長戦を行う場合は追加局を1局単位で実施。

## 不正防止
- 山札はランダム性の確保とシード管理を行う。
- 各手番の履歴をログとして保持し、リプレイ検証が可能な状態を維持する。

## UI表示ルール（実装指針）
- 自分の獲得札は画面左側に横並びでグループ化し、相手の獲得札は右側に同様のレイアウトで配置する。
- 左側の獲得札エリア下部左寄りに自分の現在局の取得点、右側エリア下部右寄りに相手の現在局の取得点を常時表示する。
- 12局通算スコアは中央下部に左右対称で表示し、ラベルでプレイヤーを識別できるようにする。
- 獲得札はカテゴリ別（光・タネ・短冊・カス）に並べる。
- 役成立時は成立役名と現在得点をダイアログ／トーストで表示する。
- コイコイ選択は明示的なボタンで行い、制限時間を設定する場合はタイマーを表示する。
- マウスホバー中の札の直下に通称（例："松に鶴"）をラベル表示し、タッチ環境ではロングタップで同様のラベルを表示する。

## 将来拡張
- 三人花札や八八など別バリアントへの拡張を検討できるよう、役判定と得点テーブルを設定ファイル化する。
- オンライン対戦対応を視野に入れ、通信プロトコルと同期処理を別モジュール化する。
