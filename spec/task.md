# 開発タスク一覧

> **テスト方針**: ゲームロジックに関する変更はブラックボックス視点（公開 API 入出力）で検証する。内部状態に直接依存するテストは避ける。

## 0. 完了済み
- [x] 画面レイアウト骨格（1332x999 想定）の実装
- [x] Bootstrap 5 導入と主要コンポーネント（ログ・アクションパネル・モーダル）整備
- [x] Pinia ストアとバックエンドモックの連携、UI 上での対局フロー表示
- [x] ドメイン層骨格 `Deck` / `Field` / `PlayerState` / `RoundState` / `GameService`
- [x] `GameState` を介した UI 用スナップショット生成とカード描画補助
- [x] vitest によるドメイン E2E テスト（山札枯渇まで自動進行）

---

## 1. コアロジック拡張
### 1.1 ラウンド制御
- [ ] 山札再配札条件（同月4枚・場全同月など）の検出と再配札手続き
- [ ] ラウンド終了後の先手決定・マッチ進行管理（複数局の履歴保持）
- [ ] 山札が尽きた際の流局処理とスコアリセット

### 1.2 役判定・得点
- [ ] `YakuEvaluator` を実装し、最低限の役（五光/四光/雨四光/三光/猪鹿蝶/花見酒/月見酒/短冊/タネ/カス）を判定
- [ ] `ScoreCalculator` で役点とコイコイ倍率の合算を行い、ラウンド終了時の得点差分を算出
- [ ] `GameState` / `GameService` に役情報・得点を残すイベントログを追加

### 1.3 コイコイ管理
- [ ] プレイヤー/CPU それぞれのコイコイ宣言状態を保持し、手番ごとに選択を促す
- [ ] コイコイ宣言後の勝敗処理（上がり不可 / 相手倍付け）を実装
- [ ] UI ログ・モーダルでコイコイ結果を通知

---

## 2. CPU 思考ロジック
- [ ] 場と手札のマッチ候補から CPU の行動を選択するアルゴリズム（ヒューリスティックベース可）
- [ ] CPU のコイコイ判断基準（自得点・相手得点差・残札枚数）
- [ ] 自動手番処理を GameService / RoundState に統合し、UI からは一連のターンを再生できるようにする
- [ ] CPU 行動をログへ記録し、UI のターン表示と同期

---

## 3. ストア & UI 調整
- [ ] `GameState` と `useMatchStore` 間でスコア・役情報・コイコイ状態をやり取りするフィールドを追加
- [ ] ログ表示のカテゴリ整理（info / success / warning / error）と最大件数制御の明文化
- [ ] コイコイ選択 UI（モーダルまたはアクションボタン）を実装し、GameService の応答に従って遷移
- [ ] CPU 手番時のハイライトや入力ロックなど、ターン制御を視覚的に反映

---

## 4. QA・テスト
- [ ] 役判定・得点計算・コイコイ処理に関するブラックボックステストを追加
- [ ] 再配札・流局など例外シナリオを含むテストケースを作成
- [ ] Playwright を用いた UI E2E テスト（1 局通しとコイコイ分岐）を整備
- [ ] 自動化テスト実行フローを npm scripts と CI（未定）に統合

---

## 5. ビジュアル・アクセシビリティ
- [ ] 役成立/コイコイ/ラウンド結果用のトースト・ダイアログ最終デザイン
- [ ] カードホバー/フォーカス時の通称表示とモバイル長押し対応
- [ ] 共通スタイルガイド文書化（色・余白・コンポーネント状態）
- [ ] キーボード操作・スクリーンリーダー対応状況の棚卸しと改善

---

## 6. 将来タスク (Phaser 移行準備)
- [ ] Vue ↔︎ Phaser のイベント境界とデータ移譲方針を設計
- [ ] Phaser シーン内でのカード描画・ドラッグ操作プロトタイプ
- [ ] Vue 側レイアウト縮小に向けたロードマップ策定
