# 開発タスク一覧

> **メモ**: ゲームロジック着手時はブラックボックス観点のテスト（入出力ベースでの振る舞い検証）を作成すること。内部実装に依存しないテストケースを優先する。

## 0. 完了済み・前提条件
- [x] 画面レイアウトの骨組み（1332x999 レイアウト、手札/場札/獲得札 UI）
- [x] Bootstrap 5 導入とスタイル基盤（カラーパレット、余白、レイヤ調整）
- [x] メニュー／プリローダ／ゲームオーバー各画面のモック
- [x] ログリスト・アクションパネル・モーダル等の主要 UI コンポーネント
- [x] UI 動作確認用バックエンドモック（`src/backend/gameBackend.js`）と Pinia 連携

---

1
### 1.1 ドメインモデル実装
- [ ] `Deck` モジュール
  - [ ] 48 枚のカードインスタンスを受け取りシャッフル・ドローを提供する
  - [ ] シード指定で再現性のある山札構築を可能にする
- [ ] `Field` モジュール
  - [ ] 月ごとのスロット管理とカード配置/取得 (`placeCard`, `collectMatches`) を実装
  - [ ] 場札4枚同月・全同月など再配札チェックを返せるようにする
- [ ] `PlayerState`
  - [ ] 手札・獲得札・得点・コイコイ状態を保持するデータ構造を定義
  - [ ] `playFromHand(cardId)`・`capture(cards)` を提供
- [ ] `RoundState`
  - [ ] 現在手番・山札残枚数・履歴を保持
  - [ ] 合法手生成 (`availableMoves`) と手番処理 (`applyMove`) をまとめる

### 1.2 役判定・スコア計算
- [ ] `YakuEvaluator`
  - [ ] 最低限の役（光・タネ・短冊・カス・猪鹿蝶・花見酒・月見酒）を判定
  - [ ] 同カテゴリ追加点のロジックを定義
- [ ] `ScoreCalculator`
  - [ ] 役の合計点 + コイコイ倍率（×2, ×4...）を算出
  - [ ] 早上がりなど追加ルールは設定でトグル可能にする

### 1.3 GameService 実装
- [ ] `startMatch(config)`
  - [ ] 山札生成・初期配札・先攻決定・`RoundState` 初期化
  - [ ] 初期 UI 用の `MatchSnapshot` を返却
- [ ] `playCard(playerId, movePayload)`
  - [ ] 手札出し → 場札マッチ → 山札ドロー → 役判定 → コイコイ判定の一連処理
  - [ ] 実行結果として新しい `MatchSnapshot` とイベントログを返却
- [ ] `resolveKoikoi(choice)`
  - [ ] コイコイ継続・終了時の状態遷移を更新
  - [ ] ラウンド終了判定・次局準備を実装

### 1.4 ストアとのインターフェース
- [ ] `GameService` をモックから差し替える API レイヤ (`src/application`) を追加
- [ ] `useMatchStore` の `loadInitialState` / `playSelectedCards` を `GameService` 呼び出しに統一
- [ ] UI で必要な `MatchSnapshot` 形式（手札・場札・獲得札・ステータス）を確定

### 1.5 ブラックボックス単体テスト
- [ ] ドメイン/サービス層を `tests/domain/*.test.ts` などに追加
  - [ ] 山札シャッフル/ドローの再現性
  - [ ] プレイヤーがカードを出したときの獲得ロジック
  - [ ] ラウンド終了時の得点計算（コイコイあり/なし）
- [ ] 入力（手番アクション）に対する出力（スナップショット/得点/ログ）で検証
- [ ] テストは内部状態に直接アクセスせず公開 API 経由で確認

---

## 2. ストア・UI 連携強化
- [ ] 手番表示
  - [ ] `GameService` の手番 ID を受け取りステータスバーに反映
  - [ ] UI の強調表示（手番側の手札ハイライト）を追加
- [ ] 選択候補の双方向制御
  - [ ] 手札→場札、場札→手札のどちらからでも候補ロードが一致するか確認
  - [ ] 非候補カードのフォーカス/クリック抑止を実装
- [ ] ログ & 通知
  - [ ] トースト UI を導入し、重要イベント（役成立、コイコイ宣言、ラウンド終了）を表示
  - [ ] ログの保持件数・カテゴリ（info/success/warning/error）の整合性を確認
- [ ] 行動パネル
  - [ ] 「ターンを終了」「コイコイ宣言」など GameService 応答に応じて活性/非活性を切り替え
  - [ ] エラーメッセージを UI レイヤで一元表示

---

## 3. 視覚デザイン・アクセシビリティ
- [ ] トースト/ダイアログの最終スタイル（Bootstrap 変数で統一）
- [ ] カードツールチップ
  - [ ] ホバー/フォーカス時に通称ラベルとカテゴリを表示
  - [ ] モバイル長押し操作のフォールバック案を用意
- [ ] 共通スタイルガイド
  - [ ] ボタン/トグル/フォームのコンポーネント方針を書面化
  - [ ] 必要なユーティリティクラス（余白、色、テキスト）を列挙
- [ ] フォント選定
  - [ ] 日本語/英語混植に対応した Web フォント候補とライセンス確認
  - [ ] Vite 経由の読み込み設定とフォールバック指定
- [ ] アクセシビリティ検証
  - [ ] キーボード操作で主要アクションが可能か確認
  - [ ] スクリーンリーダーでカード名・ボタン説明が読み上げられるかテスト

---

## 4. QA・検証フロー
- [ ] 操作フローの通し確認
  - [ ] カード選択 → 場札マッチ → 獲得ログ表示 → コイコイ選択まで手動確認
  - [ ] 例外ケース（マッチ事故、山札枯渇、再配札条件）を洗い出し TODO 化
- [ ] スクリーンショット
  - [ ] タイトル/対局/プリローダ/ゲームオーバーの最新 UI を撮影し仕様と比較
- [ ] テスト自動化
  - [ ] Vitest でゲームロジックテストを CI 対応
  - [ ] 可能であれば Playwright シナリオを追加（後日）

---

## 5. CPU 対戦相手
- [ ] 評価指標設計（役候補数・得点期待値・リスク）
- [ ] 候補生成ロジック（手札 × 場札のマッチングとスコアリング）
- [ ] コイコイ判断アルゴリズム（差点/期待値に基づく閾値）
- [ ] UI 反映（CPU 手番ハイライト・ログ出力書式・思考遅延演出）
- [ ] テスト: CPU が取り得るアクションの妥当性をブラックボックスで検証

---

## 6. Phaser への移行準備
- [ ] 移行方針まとめ（Phaser 側で扱う要素 / Vue で残す要素）
- [ ] イベントインターフェース設計（Vue → Phaser 操作意図、Phaser → Vue 結果通知）
- [ ] Phaser シーン内カード表示・入力プロトタイプ
- [ ] Vue 側レイアウトを段階的に縮小できるロードマップ策定

